# 多线程
## 基本概念
### 进程

进程是计算机中正在运行的程序的实例。每个进程都有自己独立的内存空间和系统资源，并且可以与其他进程并行执行。操作系统使用多任务调度器来管理进程，以使多个进程可以在同一时间内运行。

### 线程

线程是进程中的一个执行单元，每个进程可以有多个线程。线程与进程共享内存空间和系统资源，但它们可以同时独立运行，因为每个线程都有自己的程序计数器 （程序代码位置指针）和堆栈（存储局部变量和函数调用）。线程可以让多个任务在同一时间并行执行，从而提高计算机的效率。

从图像上看，进程就是一颗独立成树的大树，而线程就是这个大树上的子树。这样的关系使得程序在计算机中运行起来更为高效和灵活。

### 为什么使用多线程
+ 避免阻塞
> 大家知道，单个进程只有一个主线程，当主线程阻塞的时候，整个进程也就阻塞了，无法再去做其它的一些功能了。
+ 避免CPU空转
> 应用程序经常会涉及到RPC，数据库访问，磁盘IO等操作，这些操作的速度比CPU慢很多，而在等待这些响应时，CPU却不能去处理新的请求，导致这种单线程的应用程序性能很差。  cpu 》》 内存 》》 磁盘
+ 提升效率
> 一个进程要独立拥有4GB的虚拟地址空间，而多个线程可以共享同一地址空间，线程的切换比进程的切换要快得多。

## 线程创建函数CreateThread
CreateThread是一种微软在Windows API中提供了建立新的线程的函数，该函数在主线程的基础上创建一个新线程。线程终止运行后，线程对象仍然在系统中，必须通过CloseHandle函数来关闭该线程对象。
```c++
HANDLE CreateThread(
LPSECURITY_ATTRIBUTES lpThreadAttributes,//SD
SIZE_T dwStackSize,//initialstacksize
LPTHREAD_START_ROUTINE lpStartAddress,//threadfunction
LPVOID lpParameter,//threadargument
DWORD dwCreationFlags,//creationoption
LPDWORD lpThreadId//threadidentifier
)
```
+ 第一个参数 lpThreadAttributes 表示线程内核对象的安全属性，一般传入NULL表示使用默认设置。
+ 第二个参数 dwStackSize 表示线程栈空间大小。传入0表示使用默认大小（1MB）。
+ 第三个参数 lpStartAddress 表示新线程所执行的线程函数地址，多个线程可以使用同一个函数地址。
+ 第四个参数 lpParameter 是传给线程函数的参数。
+ 第五个参数 dwCreationFlags 指定额外的标志来控制线程的创建，为0表示线程创建之后立即就可以进行调度，如果为CREATE_SUSPENDED则表示线程创建后暂停运行，这样它就无法调度，直到调用ResumeThread()。
+ 第六个参数 lpThreadId 将返回线程的ID号，传入NULL表示不需要返回该线程ID号

```c++
  unsigned long _beginthreadex(
  
    void *security,    // 安全属性， 为NULL时表示默认安全性
 
    unsigned stack_size,    // 线程的堆栈大小， 一般默认为0
 
    unsigned(_stdcall *start_address)(void *),   // 线程函数
 
    void *argilist, // 线程函数的参数
 
   unsigned initflag,    // 新线程的初始状态，0表示立即执行，//CREATE_SUSPENDED表示创建之后挂起
    unsigned *threaddr    // 用来接收线程ID
 
);
```
返回值 : // 成功返回新线程句柄， 失败返回0

__stdcall表示

1.参数从右向左压入堆栈

2.函数被调用者修改堆栈
